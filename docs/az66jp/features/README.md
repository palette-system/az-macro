# AZ-66JP 製品特徴

<br>
<br>

## ■ 暗記ボタン機能
![ankey_img](/images/az66jp/ankey_img.jpg)<br>
キーの推した順番、離した順番を暗記して１つのボタンに覚えさせる機能を付けました。<br>
同じ入力を繰り返し入力したい場合、使用頻度が多ければ今までツールやショートカットキーを登録すれば実現できたのですが、使用頻度が少ない物は登録するのがいちいち面倒くさい場合が多く簡単な物であればそのままキーボードで同じ入力を繰り返している事が多かったのでこの機能を作りました。<br>
「暗記ボタン」を使う事でツールや設定をせず、今欲しいショートカットキーをスグに作る事ができます。<br>
使い方としては「暗記ボタン」として登録してあるキーを長押しするとキーボードが暗記モードになります。暗記モード中に入力したキー情報(暗記モード中も普通にキー入力されます)を最大1000回までキーを押した、離したの情報を暗記できます。<br>
暗記させたいキー入力が終わったらもう一度「暗記ボタン」を押すと暗記終了になります。暗記データがある状態で「暗記ボタン」を押すと暗記してある入力が自動で入力されます。<br>
「暗記ボタン」はキーマップの設定からいくつも登録できてESP32の容量が許す限り登録可能です。(計算では役3000個登録しても大丈夫な計算です)<br>
暗記したデータはESP32内に保存しますので、キーボードを再起動しても暗記した内容は保持されます。<br>
　※ 暗記するのはどのキーを押したかという情報なので、該当のキーのキーマップを書き換えると入力される内容も変わります<br>
　※ CtrlやAlt、カーソルキーやエンターキーTabキーなど登録できる全てのキーの暗記が可能です。<br>
　※ 「Ctrl＋C」→「Ctrl＋V」→「Ctrl＋V」→「Ctrl＋V」を暗記して選択したテキストを複数回張り付けるなども可能です<br>

<br>
<br>

## ■ 打鍵ヒートマップ機能
キーボードを起動してから現在までのトータル打鍵数とキーごとの打鍵数を30分おきにデータを残す事で、今どれくらいのペースでキーボードを入力したかを分かるようにしました。<br>
打鍵数は本体の液晶で確認できるだけでなく、液晶に表示されたQRコードを読み込めばスマホやPCからも打鍵ヒートマップを見れます。<br>
今の所は起動してからどれくらい打鍵したかしか見れませんが、ESP32本体に過去の打鍵数を保存できる容量はあるので今後のファームウェアアップデートで過去の分もさかのぼって確認できるようにする予定です。<br>

<br>
<br>

## ■ アプリのインストール無し、専門知識無しにキーマップを変更できる
AZ-Macro同様のファームウェアを採用し、スマホやPCからWifiに接続するだけで設定画面が開けます。<br>
専門知識が無くても設定画面を見ればすぐに操作できるようになっていて、自作キーボードを初めて触る方でも簡単にキーマップの編集が行えます。<br>
レイヤー機能も搭載していて、Fnボタンのように押したまま他のボタンを押した時の動作を登録できます。レイヤー数に制限は無く16レイヤーほど作成しても問題なく動作しました。<br>

<br>
<br>

## ■ 初めての人も使いやすい日本語配列
66キーの60％サイズなので十字キーが横並びになっていたりスペースキーを狭くしていますが、普段使っているキーボードに近い日本語配列を採用しました。<br>
デフォルトのキーマップでは左下のCtrlの隣がレイヤー切り替えボタンとなっていて、そのボタンを押したまま最上列のキーを押すとF1～F12のファンクションキーも押せます。<br>
全てのキーに割り当てられるキーは設定ページから好きなように変更できます。<br>

<br>
<br>

## ■ 対応OS
WindowsやMacでの使用はもちろんの事、Android、iPhone、iPadなどのモバイル端末との接続もできるようになっています。<br>
特にiOSへ問題なく接続できる製品は少ないようでライブラリの修正が大変でしたが問題なく接続できるようになっています。<br>
また日本語キーボード←→USキーボードの変更も設定画面から変更できるようになっているので、PCやスマホの設定に合わせて変更して下さい。<br>

<br>
<br>

## ■ 打鍵音、打鍵感
打鍵音はメカニカルスイッチを使用する上で重要な要素と考えており音についてはかなりこだわりました。<br>
打鍵時のPCBのカチャカチャ音を失くすためトッププレートは隙間の少ない専用の5mmアクリルプレートを採用。<br>
構造はトッププレートとボトムプレートを支柱でとめるのが主流ですが、そうするとボトムプレートに振動が伝わりボトムプレートがカチャカチャ鳴ってしまうので、あえて繋げず間に滑り止め用のスポンジでPCBとトッププレートを支える構造にしました。<br>
スポンジが振動を吸収してくれるので長時間の作業での指への負担を軽減してくれるのと、スポンジ内に空気が入っているため静音材の役割も果たしてくれて余計な音が鳴るのをを減らしてくれます。<br>
キーボードの裏にもこだわり、ゴム足を使用せず裏にもスポンジを採用しました。<br>
ゴム足を付けると机とボトムプレートの間に空いた空間のせいでボトムプレートから響き音が出てしまうので、点ではなく面でキーボードを支える事で余計な音が鳴るのを減らしてくれます。<br>
打鍵音には好みがあるので一概に良し悪しを決める事はできないのですが、テスターでテストしている打鍵音に近い状態でキー入力できるようこだわりましたので是非試してみて下さい。<br>

<br>
<br>

## ■ ESP32
![esp32_img](/images/az66jp/esp32_img.jpg)<br>
マイコンはESP32-WROVER-E(16MB)を採用しました。このマイコンは消費電力も大きいし、本体サイズも大きくPCBへの配置もしにくいため自作キーボードに向いていません。<br>
あえてESP32を採用したのは、現在キーボードで主流であるAVRマイコンに比べメモリも大きく多機能(Wifi、Bluetooth、タッチセンサ、DACなど)であるため今までのキーボードでは実装できなかったいろいろな機能が付ける事ができると考えました。<br>
AZ-66JPでは他のキーボードに無い機能をお届けいたします。<br>

<br>
<br>

## ■ カラー液晶
キーボードに機能を追加していく上で操作情報を画面表示するために液晶が必須になり採用しました。<br>
ESP32の大容量があるのでカラーで画像表示をしたかったのと、空いたスペースに収まる最大のサイズにしたく240×135というサイズの液晶を採用しました。<br>
液晶の表示ライブラリが動作が遅い物が多く、表示を切り替えている間にキー入力がされるとキーが入力されない事があったので、ライブラリの通信部分の高速化や、画面の一部分だけの書換えで通信量を減らすなどしてキー入力に影響が出ないよう調整するのに苦労しました。<br>
部屋を暗くすると液晶が眩しくなってしまうため、液晶裏にボリュームを付けて液晶の明るさを調整できるようになっています。<br>
そのままボリュームを付けるとPCB外に飛び出た部分がGH60サイズのケースにあたってしまい入らなくなるので、PCBを少し凹ませてその部分でボリュームを調節できるようになっています。<br>
設定ページからJPEG、PNGの画像ファイルを設定すれば待ち受けの画像を変更できます。<br>

<br>
<br>

## ■ GH60のケース互換
GH60互換のケースは種類が多く沢山のデザインや素材があるため、初めて自作キーボードを手にする方が選びやすいケースだと思います。<br>
なのでPCBはGH60互換となるよう設計しました。アルミのケースも2種類ほど試しましたが問題なくBluetooth接続できました。<br>
ESP32の実装位置も、最初は裏面に設置していたのですがそうするとケースによってぶつかってしまう事があったのでGH60ケース互換にするためにESP32の実装は表面になっています。<br>
　※ 細かい所で差があったり表面実装しているパーツに干渉する可能性があるので互換ケースに入れる際は自己責任でお願いいたします<br>

<br>
<br>

## ■ 電源の接続
基本電源はモバイルバッテリーの利用を想定していますが、1種類のコネクタだけではなく選べるようにしました。<br>
コネクタをMicroB、Type-C、銅線から選ぶ事ができます。PCはもちろんUSB充電用のアダプタからUSBコネクタへの給電や、乾電池だと単３を３～４本で動作する事ができます。<br>
キットで購入するとコネクタははんだ付けされていない状態ですので、銅線をはんだ付けしてドーターボードから給電する事も可能です。<br>
またUSBコネクタから電源スイッチの間にスルーホールの穴があけてあり、知識のある方はここにリチウムバッテリーの充電モジュールなどを拡張したりの改造ができるようになっています。(ここの拡張に関しては自己責任でお願いいたします)<br>
　※ MicroBコネクタのモバイルバッテリーを変換コネクタを使用してType-Cに変換してから給電するとバッテリーを認識しない場合があります。その場合AZ-66JPの電源スイッチをONのままType-Cのコネクタをゆっくりさすと認識します。<br>
　※ 給電電圧は3.5～8Vの範囲内でお願いします。8V以上の電圧を流すとキーボードが壊れます。<br>
　※ 給電電流は500mAほど必要でCR2012などのボタン電池では電流が足りず起動しません。<br>

<br>
<br>

## ■ バッテリー内蔵ボトムプレート
専用のバッテリー内蔵のプレートは必要だと思いオプションとして作成しました。<br>
まずシンプルで安全というのが最優先にあったのでバッテリーユニットはモバイルバッテリーを採用しました。<br>
次に可能な限り薄くしたかったのでモバイルバッテリーの中で薄くて手に入りやすい物を採用し、それに合うサイズのボトムプレートを作成しました。<br>
重みもあるのでキー入力時の安定感につながり完成度の高いプレートになりました。<br>
　※ PCBとの接続はMicroBコネクタでの接続をお願い致します。<br>

<br>
<br>

## ■ キースイッチのホットスワップ
キースイッチは直接はんだ付けではなくソケットを使用したホットスワップを採用しました。<br>
打鍵ヒートマップ機能によりキーごとの使用頻度が可視化できるため、使用頻度を元にキーごとに重みの違うスイッチに変更したりチューニングができる仕様になっています。<br>
<br>
<br>


## ■ 全てのキーにカラーLED搭載
![color_led_img](/images/az66jp/color_led_img.jpg)<br>
通常Bluetoothキーボードでは電池の消費が激しいのでカラーLEDは付けないのが主流なのですが、せっかくの自作キーボードなので全てのキーに対してカラーLEDを搭載しました。<br>
ライトのON/OFFや、明るさ調節、カラー設定などは変えたい時にぱっと変更できるようツールから設定せず「Fn ＋ Q」などのキーでキーボード上で設定が変更できる仕様になっています。<br>
※ LEDをはんだ付けしなくてもキーボードとして機能しますので消費電力を抑えたい場合はLED無しでも組み立て可能です。<br>
<br>
<br>


## ■ WEBフック
AZ-Macro同様WEBフックを使えるようにしました。キースイッチが押されたのをトリガーにHTTPリクエストを送信できます。<br>
IFTTTと連携して家電の操作や、自前で用意したWEBAPIを実行する事ができます。<br>

<br>
<br>

## ■ マウス操作
AZ-Macro同様マウス操作も可能です。<br>
キーを押している間カーソルを上下左右へ移動したり、右クリック、左クリックなども登録可能です。<br>

<br>
<br>

## ■ 連打機能
AZ-Macro同様キーを押している間、指定したキーを連打する事ができます。<br>
連打の速度は細かく設定できるようになっています。<br>
